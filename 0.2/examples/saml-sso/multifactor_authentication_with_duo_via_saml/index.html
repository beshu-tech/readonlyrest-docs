
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.3.1, mkdocs-material-8.4.1">
    
    
      
        <title>Duo Security MFA - ReadonlyREST Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.69437709.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.cbb835fc.min.css">
        
      
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#duo-security-mfa" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-component="outdated" hidden>
        
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="ReadonlyREST Documentation" class="md-header__button md-logo" aria-label="ReadonlyREST Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            ReadonlyREST Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Duo Security MFA
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="ReadonlyREST Documentation" class="md-nav__button md-logo" aria-label="ReadonlyREST Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    ReadonlyREST Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        README
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../SUMMARY/" class="md-nav__link">
        Table of contents
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../changelog/" class="md-nav__link">
        Changelog
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../commercial/" class="md-nav__link">
        Commercial Licenses
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../contributing/" class="md-nav__link">
        Contribution License Agreement
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../elasticsearch/" class="md-nav__link">
        For Elasticsearch
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../kibana/" class="md-nav__link">
        For Kibana
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8" type="checkbox" id="__nav_8" >
      
      
      
      
        <label class="md-nav__link" for="__nav_8">
          Actionstrings
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Actionstrings" data-md-level="1">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          Actionstrings
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../actionstrings/" class="md-nav__link">
        List of Elasticsearch actions available in various Elasticsearch versions
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_9" type="checkbox" id="__nav_9" >
      
      
      
      
        <label class="md-nav__link" for="__nav_9">
          Details
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Details" data-md-level="1">
        <label class="md-nav__title" for="__nav_9">
          <span class="md-nav__icon md-icon"></span>
          Details
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../details/fips/" class="md-nav__link">
        FIPS mode
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../details/fls-engine/" class="md-nav__link">
        FLS engine
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../details/groups-rule-mapping/" class="md-nav__link">
        External to local groups mapping
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../details/impersonation/" class="md-nav__link">
        Impersonation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../details/index-not-found-examples/" class="md-nav__link">
        "Index not found" scenario
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../details/indices-rule-templates/" class="md-nav__link">
        Templates handling in `indices` rule
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../details/kibana-7.8.x-and-older/" class="md-nav__link">
        Kibana 7.8.x and older
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_10" type="checkbox" id="__nav_10" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_10">
          Examples
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Examples" data-md-level="1">
        <label class="md-nav__title" for="__nav_10">
          <span class="md-nav__icon md-icon"></span>
          Examples
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../" class="md-nav__link">
        Examples
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../multitenancy_guide/" class="md-nav__link">
        Multi-tenancy Elastic Stack
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../multiuser_guide/" class="md-nav__link">
        Multi-user Elastic Stack
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_10_4" type="checkbox" id="__nav_10_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_10_4">
          Impersonation
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Impersonation" data-md-level="2">
        <label class="md-nav__title" for="__nav_10_4">
          <span class="md-nav__icon md-icon"></span>
          Impersonation
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../impersonation/external-services-mocks-ui/" class="md-nav__link">
        External services mocks configuration
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../impersonation/impersonate-user-ui/" class="md-nav__link">
        Impersonate user ui
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../impersonation/test-settings-ui/" class="md-nav__link">
        Writing Test Settings
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_10_5" type="checkbox" id="__nav_10_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_10_5">
          Oidc sso
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Oidc sso" data-md-level="2">
        <label class="md-nav__title" for="__nav_10_5">
          <span class="md-nav__icon md-icon"></span>
          Oidc sso
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../oidc-sso/" class="md-nav__link">
        OpenID Connect (OIDC) SSO
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../oidc-sso/keycloak_oidc/" class="md-nav__link">
        Keycloak
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_10_6" type="checkbox" id="__nav_10_6" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_10_6">
          Saml sso
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Saml sso" data-md-level="2">
        <label class="md-nav__title" for="__nav_10_6">
          <span class="md-nav__icon md-icon"></span>
          Saml sso
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        SAML SSO
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../adfs/" class="md-nav__link">
        Microsoft ADFS
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../azure_ad/" class="md-nav__link">
        Microsoft Azure AD
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../keycloak_saml/" class="md-nav__link">
        Keycloak
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Duo Security MFA
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Duo Security MFA
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#duo-access-gateway-dag-server-configuration" class="md-nav__link">
    Duo Access Gateway (DAG) server configuration
  </a>
  
    <nav class="md-nav" aria-label="Duo Access Gateway (DAG) server configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#installing-duo-gateway" class="md-nav__link">
    Installing Duo Gateway
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuring-authentication-source" class="md-nav__link">
    Configuring Authentication Source
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configure-application-in-duo-admin-dashboard" class="md-nav__link">
    Configure Application in Duo Admin Dashboard
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#readonlyrest-configuration" class="md-nav__link">
    ReadonlyRest Configuration
  </a>
  
    <nav class="md-nav" aria-label="ReadonlyRest Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configuring-the-elasticsearch-plugin" class="md-nav__link">
    Configuring the Elasticsearch plugin
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuring-the-kibana-plugin" class="md-nav__link">
    Configuring the Kibana plugin
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elasticsearch-index-in-kibana-ror-dashboard" class="md-nav__link">
    Elasticsearch index in Kibana ROR Dashboard
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#login-with-saml-2fa-enabled" class="md-nav__link">
    Login with SAML 2FA enabled
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#logout-from-saml-from-readonlyrest-enterprise-logout-button" class="md-nav__link">
    Logout from SAML from ReadonlyREST Enterprise logout button
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#duo-access-gateway-dag-server-configuration" class="md-nav__link">
    Duo Access Gateway (DAG) server configuration
  </a>
  
    <nav class="md-nav" aria-label="Duo Access Gateway (DAG) server configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#installing-duo-gateway" class="md-nav__link">
    Installing Duo Gateway
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuring-authentication-source" class="md-nav__link">
    Configuring Authentication Source
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configure-application-in-duo-admin-dashboard" class="md-nav__link">
    Configure Application in Duo Admin Dashboard
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#readonlyrest-configuration" class="md-nav__link">
    ReadonlyRest Configuration
  </a>
  
    <nav class="md-nav" aria-label="ReadonlyRest Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configuring-the-elasticsearch-plugin" class="md-nav__link">
    Configuring the Elasticsearch plugin
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuring-the-kibana-plugin" class="md-nav__link">
    Configuring the Kibana plugin
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elasticsearch-index-in-kibana-ror-dashboard" class="md-nav__link">
    Elasticsearch index in Kibana ROR Dashboard
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#login-with-saml-2fa-enabled" class="md-nav__link">
    Login with SAML 2FA enabled
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#logout-from-saml-from-readonlyrest-enterprise-logout-button" class="md-nav__link">
    Logout from SAML from ReadonlyREST Enterprise logout button
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                


<h1 id="duo-security-mfa">Duo Security MFA</h1>
<p>This tutorial is a step by step guide for the integration between <a href="https://duo.com">DUO</a> multi factor authentication provider and <a href="https://readonlyrest.com/enterprise">ReadonlyREST Enterprise</a>.</p>
<p>The multi factor authentication (MFA) provided by DUO is an additional authorization step for the user after they have inserted the correct credentials. This extra step is mediated by the DUO platform and it is either an SMS, a push notification to their app, or a one time password obtained via their app or google authenticator.</p>
<p>For this tutorial you are going to need:</p>
<ul>
<li>A valid installation of ReadonlyREST Enterprise (trial, or official) Kibana plugin. If you haven't got one, <a href="https://readonlyrest.com/enterprise">get your own trial build here</a>.</li>
<li>A valid trial or paid account in DUO website (see <a href="https://duo.com/pricing">pricing</a>, you are going to need the "Remote Access &amp; Single Sign-On (SSO)" feature.</li>
</ul>
<h2 id="duo-access-gateway-dag-server-configuration">Duo Access Gateway (DAG) server configuration</h2>
<p>The access gateway is a piece of software released by DUO that takes care of integrating on premises service providers like ReadonlyREST SAML with arbitrary identity providers (like LDAP) and the multi factor authentication features offered by DUO platform.</p>
<h3 id="installing-duo-gateway">Installing Duo Gateway</h3>
<p>Follow the instructions for Duo Gateway (<a href="https://duo.com/docs/dag-linux">https://duo.com/docs/dag-linux</a>). The gateway is a Docker container and it will need the ports 80 and 443 to be available, so you will probably need a dedicated VM or Bare Metal so that Duo Gateway can properly bind to these ports.</p>
<h3 id="configuring-authentication-source">Configuring Authentication Source</h3>
<p>Once the Duo Gateway is installed, open a browser and point to its web interface to configure it. When you configure the authentication sources, be sure to set the correct username attribute. Keep in mind this value because it will be mapped directly to whatever has been configured in the actual Duo.com dashboard, under <code>Gateway &gt; Applications</code> (which we are just about to configure).</p>
<p><img alt="Source" src="../../.gitbook/assets/duo-dag-config (1) (1) (1).png" /></p>
<h3 id="configure-application-in-duo-admin-dashboard">Configure Application in Duo Admin Dashboard</h3>
<p>In the Duo Administration dashboard, go to Applications. Click <code>Protect an Application</code>, then search for <code>Generic</code> and click <code>Protect this Application</code> button.</p>
<p>This will create a generic SAML provider. Set these fields:</p>
<ul>
<li>Service provider name: A name that refers to your ReadonlyREST Enterprise installation</li>
<li>EntityID: Set an existing entity name or use the same as Service Provider Name</li>
<li>Assertion Consumer Service: The SAML Url assertion found in metadata.xml, the url format is <code>&lt;kibanaExternalHost&gt;/ror_kbn_sso/assert</code>.</li>
</ul>
<p><img alt="SP" src="../../.gitbook/assets/duo-saml-sp (1) (3) (3) (3) (3) (2) (4).png" /></p>
<p>In SAML Response, set NameID to be the same variable name as configured previously in the authentication source. Leave the default values for the remaining settings. Click <code>Save Application</code> and scroll up and download the configuration file.</p>
<h2 id="readonlyrest-configuration">ReadonlyRest Configuration</h2>
<p>To configure SAML, both Kibana and Elasticsearch ROR configuration needs to be edited to enable SAML in Duo Gateway.</p>
<h3 id="configuring-the-elasticsearch-plugin">Configuring the Elasticsearch plugin</h3>
<p>Open your <code>readonlyrest.yml</code> file or login as a local administrator in your ReadonlyREST Enterprise, and add this extra configuration required for SAML authentication.</p>
<pre><code>readonlyrest:
  access_control_rules:

#    [... all your regular ACL blocks ...]

    - name: &quot;ReadonlyREST Enterprise Kibana instance #1&quot;
      ror_kbn_auth:
        name: &quot;kbn1&quot;

# OPTIONAL FOR SECONDARY KIBANA ###
#
#    - name: &quot;ReadonlyREST Enterprise Kibana instance #2&quot;
#      ror_kbn_auth:
#        name: &quot;kbn2&quot;

  ror_kbn:
    - name: kbn1
      signature_key: &quot;shared_secret_kibana1_(256+chars)&quot; # &lt;- use environmental variables for better security!

# OPTIONAL FOR SECONDARY KIBANA ###
#    - name: kbn2
#      signature_key: &quot;shared_secret_kibana2(256+chars)&quot; # &lt;- use environmental variables for better security!
</code></pre>
<p>This authentication and authorization connector represents the secure channel (based on JWT tokens) of signed messages necessary for our Enterprise Kibana plugin to securely pass back to ES the username and groups information coming SAML identity provider.</p>
<h3 id="configuring-the-kibana-plugin">Configuring the Kibana plugin</h3>
<p>Edit $KIBANA_HOME/conf/kibana.yml configuration and append:</p>
<pre><code>readonlyrest_kbn.auth:
  signature_key: “a very long key (more than 256 characters) goes here …..” # the same signing key added above in ES config
  saml:
    enabled: true
    entryPoint: 'https://duo-gateway.xyz/dag/saml2/idp/SSOService.php?spentityid=demo'
    kibanaExternalHost: 'ror-deployment.xyz' # &lt;-- public URL used by the Identity Provider to call back Kibana with the &quot;assertion&quot; message
    usernameParameter: 'nameID'
    groupsParameter: 'memberOf'
    logoutUrl: 'https://duo-gateway.xyz/dag/saml2/idp/SingleLogoutService.php?ReturnTo=https://duo-gateway.xyz/dag/module.php/duosecurity/logout.php'
    decryptionCert: certs/dag.crt
    cert: certs/dag.crt
</code></pre>
<p>The following fields are mapped to the Duo Gateway Application Metadata:</p>
<ul>
<li>entryPoint: LoginUrl for the SAML Generic Application</li>
<li>usernameParameter: Default SAML Generic Application value is <code>nameID</code></li>
<li>logoutUrl: a URL that points to the value found in the screen <code>Metadata &gt; Logout URL</code></li>
<li>decryptionCert: The downloadable certificate in Metadata (absolute path)</li>
<li>cert: The downloadable certificate in Metadata (absolute path)</li>
<li>signature_key: Signing key string for JWT, must match the same key value in elasticsearch ROR config</li>
<li>kibanaExternalHost: The Kibana (with ReadonlyREST Enterprise) instance public hostname</li>
<li>protocol: protocol schema (http or https) of the external Kibana host</li>
<li>issuer: distinctive name of the identity provider (optional)</li>
<li>decryptionPvk: service provider private key (string value) (optional)</li>
</ul>
<p>For more advanced configurations and information, please refer to <a href="https://github.com/bergie/passport-saml">passport-saml documentation</a></p>
<h3 id="elasticsearch-index-in-kibana-ror-dashboard">Elasticsearch index in Kibana ROR Dashboard</h3>
<p>Make sure to update signature_key in ROR Dashboard with the value. Otherwise you will get JWT errors while login with SAML.</p>
<h2 id="login-with-saml-2fa-enabled">Login with SAML 2FA enabled</h2>
<p>Go to ReadonlyREST Login page (<a href="http://ror-deployment.xyz/login">http://ror-deployment.xyz/login</a>) and click the SAML SSO button. This will redirect to Duo Security Gateway and ask for a two factor code to proceed. Note that the first time it will provision a two factor seed mapped to the user account.</p>
<p>Once Duo authenticates, it will redirect you to the private Kibana session powered by ReadonlyREST Enterprise.</p>
<h2 id="logout-from-saml-from-readonlyrest-enterprise-logout-button">Logout from SAML from ReadonlyREST Enterprise logout button</h2>
<p>Click the Logout button from ROR Dashboard. This will redirect you to Duo Gateway logout completion page. Follow the instructions and close the window.</p>




              
            </article>
            
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../keycloak_saml/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Keycloak" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Keycloak
            </div>
          </div>
        </a>
      
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../..", "features": [], "search": "../../../assets/javascripts/workers/search.ecf98df9.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.9c69f0bc.min.js"></script>
      
    
  </body>
</html>